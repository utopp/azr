<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Credential Chain for Seamless OAuth 2.0 Authentication to Azure Services • azr</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Credential Chain for Seamless OAuth 2.0 Authentication to Azure Services">
<meta name="description" content="Implements a credential chain for Azure OAuth 2.0 authentication based on the package httr2's OAuth framework. Sequentially attempts authentication methods until one succeeds. During development allows interactive browser-based flows (Device Code and Auth Code flows) and non-interactive flow (Client Secret) in batch mode.">
<meta property="og:description" content="Implements a credential chain for Azure OAuth 2.0 authentication based on the package httr2's OAuth framework. Sequentially attempts authentication methods until one succeeds. During development allows interactive browser-based flows (Device Code and Auth Code flows) and non-interactive flow (Client Secret) in batch mode.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">azr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pedrobtz/azr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="azr">azr<a class="anchor" aria-label="anchor" href="#azr"></a>
</h1></div>
<!-- badges: start -->

<p>azr implements a credential chain for seamless OAuth 2.0 authentication to Azure services. It builds on <a href="https://httr2.r-lib.org/" class="external-link">httr2</a>’s OAuth framework to provide cache and automatic credential discovery, trying different authentication methods in sequence until one succeeds.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of azr from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"utopp/azr"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The package supports:</p>
<ul>
<li>
<strong>Client Secret Credential</strong>: Service principal authentication with client ID and secret</li>
<li>
<strong>Azure CLI Credential</strong>: Leverages existing Azure CLI (<code>az</code>) login</li>
<li>
<strong>Authorization Code Flow</strong>: Interactive browser-based authentication</li>
<li>
<strong>Device Code Flow</strong>: Authentication for headless or CLI environments</li>
</ul>
<p>During interactive development, azr allows browser-based login flows, while in batch/production mode it seamlessly falls back to non-interactive methods.</p>
</div>
<div class="section level2">
<h2 id="related-work">Related work<a class="anchor" aria-label="anchor" href="#related-work"></a>
</h2>
<p>azr is inspired by Python’s <a href="https://learn.microsoft.com/en-us/python/api/overview/azure/identity-readme" class="external-link">azure-identity</a> library, which provides comprehensive coverage of Azure authentication scenarios and introduced the credential chain pattern for automatic authentication method discovery.</p>
<p>The R package <a href="https://github.com/Azure/AzureAuth" class="external-link">AzureAuth</a> (based on <a href="https://httr.r-lib.org/" class="external-link">httr</a>) also provides token acquisition for Azure services, but does not offer an explicit way to define credential chains. This becomes important in scenarios where different authentication methods require different configurations. For example:</p>
<ul>
<li>
<strong>Client Secret Credentials</strong>: Using a service principal <code>client_id</code> with an application-specific <code>scope</code>
</li>
<li>
<strong>Interactive Credentials</strong>: Using user authentication with different credentials</li>
</ul>
<p>azr addresses this by allowing you to define custom credential chains with method-specific configurations, enabling seamless fallback between authentication approaches.</p>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>The simplest way to authenticate is using <code><a href="reference/get_token.html">get_token()</a></code>, which automatically tries different authentication methods until one succeeds:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pedrobtz.github.io/azr/">azr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get a token using the default credential chain</span></span>
<span><span class="va">token</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_token.html">get_token</a></span><span class="op">(</span></span>
<span>  tenant_id <span class="op">=</span> <span class="st">"your-tenant-id"</span>,</span>
<span>  scope <span class="op">=</span> <span class="st">"https://management.azure.com/.default"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the token with httr2</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://httr2.r-lib.org" class="external-link">httr2</a></span><span class="op">)</span></span>
<span><span class="va">req</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/request.html" class="external-link">request</a></span><span class="op">(</span><span class="st">"https://management.azure.com/subscriptions"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://httr2.r-lib.org/reference/req_auth_bearer_token.html" class="external-link">req_auth_bearer_token</a></span><span class="op">(</span><span class="va">token</span><span class="op">$</span><span class="va">access_token</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html" class="external-link">req_perform</a></span><span class="op">(</span><span class="va">req</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, use <code><a href="reference/get_request_authorizer.html">get_request_authorizer()</a></code> to get a function that adds authentication to requests:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pedrobtz.github.io/azr/">azr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://httr2.r-lib.org" class="external-link">httr2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get a request authorizer for Microsoft Graph API</span></span>
<span><span class="va">azr_req_auth</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_request_authorizer.html">get_request_authorizer</a></span><span class="op">(</span></span>
<span>  tenant_id <span class="op">=</span> <span class="st">"your-tenant-id"</span>,</span>
<span>  scope <span class="op">=</span> <span class="st">"https://graph.microsoft.com/.default"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use it to authenticate requests</span></span>
<span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/request.html" class="external-link">request</a></span><span class="op">(</span><span class="st">"https://graph.microsoft.com/v1.0/me"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">azr_req_auth</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html" class="external-link">req_perform</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>You can customize which authentication methods are tried and in what order:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a custom credential chain with specific credential instances</span></span>
<span><span class="va">custom_chain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va"><a href="reference/ClientSecretCredential.html">ClientSecretCredential</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    scope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"APP_SCOPE"</span><span class="op">)</span>,</span>
<span>    client_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"APP_CLIENT_ID"</span><span class="op">)</span>,</span>
<span>    client_secret <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"APP_CLIENT_SECRET"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="va">AzureCLICredential</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the custom chain</span></span>
<span><span class="va">token</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_token.html">get_token</a></span><span class="op">(</span></span>
<span>  tenant_id <span class="op">=</span> <span class="st">"your-tenant-id"</span>,</span>
<span>  scope <span class="op">=</span> <span class="st">"https://management.azure.com/.default"</span>,</span>
<span>  .chain <span class="op">=</span> <span class="va">custom_chain</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h2>
<p>Please note that the azr project is released with a <a href="https://contributor-covenant.org/version/2/1/CODE_OF_CONDUCT.html" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=azr" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/pedrobtz/azr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/pedrobtz/azr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing azr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Pedro Baltazar <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/pedrobtz/azr/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/pedrobtz/azr/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pedro Baltazar.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
